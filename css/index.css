/*
 * Burning House - Minimal CSS
 * Rebuilt from scratch, January 2026
 *
 * Breakpoints:
 *   - Mobile: < 768px (single column, notes inline)
 *   - Tablet: 768px - 1199px (notes in margin, scaled)
 *   - Desktop: >= 1200px (full layout, centered)
 */

/* ==========================================================================
   Variables & Dark Mode
   ========================================================================== */

:root {
	/* Palette */
	--paper: #f6f0e8;
	--paper-2: #efe6db;
	--ink: #241425;
	--ink-2: #3a223a;
	--vermillion: #8f1d14;
	--rule: #241425;

	/* Typography */
	--font-body:
		"Vollkorn", "Noto Serif TC", "Source Han Serif TC", ui-serif, Georgia, serif;
	--font-display:
		"Source Sans 3", "Noto Sans TC", ui-sans-serif, system-ui, sans-serif;
	--font-mn:
		"Gill Sans", "Lato", "Noto Sans TC", ui-sans-serif, system-ui, sans-serif;

	--text-size: 1.375rem; /* 22px at 100% = 16px base */
	--leading: 1.65; /* proportional increase */
	--measure: 67ch;

	/* Layout */
	--page-pad: clamp(1rem, 3vw, 2rem);
	--mn-width: 240px;
	--mn-gap: 2rem;
}

@media (prefers-color-scheme: dark) {
	:root {
		--paper: #1a1a1a;
		--paper-2: #242424;
		--ink: #e8e0d8;
		--ink-2: #c0b8b0;
		--vermillion: #e85a4f;
		--rule: #e8e0d8;
	}
}

/* ==========================================================================
   Base Elements
   ========================================================================== */

html {
	font-size: 100%;
	scroll-behavior: smooth;
}

body {
	font-family: var(--font-body);
	font-size: var(--text-size);
	line-height: var(--leading);
	color: var(--ink);
	background: var(--paper);
	margin: 0;
	padding: 0;
	-webkit-font-smoothing: antialiased;
}

/* Links */
a {
	color: var(--ink);
	text-decoration: underline;
	text-decoration-color: var(--vermillion);
	text-underline-offset: 0.15em;
	text-decoration-thickness: 1.5px;
}

a:visited {
	color: var(--ink-2);
}

a:hover {
	text-decoration-thickness: 2px;
}

/* Headings */
h1,
h2,
h3,
h4 {
	font-family: var(--font-display);
	font-weight: 700;
	line-height: 1.2;
	margin: 1.5em 0 0.5em;
}

h1 {
	font-size: 2rem;
}
h2 {
	font-size: 1.5rem;
}
h3 {
	font-size: 1.25rem;
}
h4 {
	font-size: 1.1rem;
}

/* Paragraphs */
p {
	margin: 0 0 1em;
}

/* Blockquotes - no italics, indented */
blockquote {
	margin: 1.5em 0;
	padding-left: 2em;
	border: none;
	font-style: normal;
}

/* Preformatted - use body font */
pre,
code {
	font-family: var(--font-body);
	font-size: 0.95em;
}

pre {
	overflow-x: auto;
	padding: 1em;
	background: var(--paper-2);
	border-radius: 4px;
}

/* Images */
img {
	max-width: 100%;
	height: auto;
	display: block;
}

/* Horizontal rules */
hr {
	border: none;
	border-top: 1px solid var(--rule);
	margin: 2em 0;
}

/* CJK: Never italicize Chinese characters */
em:lang(zh),
em:lang(zh-Hans),
em:lang(zh-Hant),
i:lang(zh),
i:lang(zh-Hans),
i:lang(zh-Hant),
em:lang(ja),
i:lang(ja),
em:lang(ko),
i:lang(ko) {
	font-style: normal;
	/* Could add emphasis dots or other styling here */
}

/* Broader catch: any CJK text within italics */
:is(em, i) :is([lang^="zh"], [lang^="ja"], [lang^="ko"]) {
	font-style: normal;
}

/* ==========================================================================
   Layout
   ========================================================================== */

main {
	padding: var(--page-pad);
}

/* Header */
header {
	padding: var(--page-pad);
	border-bottom: 1px solid var(--rule);
}

.site-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	max-width: calc(var(--measure) + var(--mn-width) + var(--mn-gap) + 4rem);
	margin: 0 auto;
}

.home-link {
	display: flex;
	align-items: center;
	gap: 0.75rem;
	font-family: var(--font-display);
	font-weight: 700;
	font-size: 1.1rem;
	text-decoration: none;
}

.site-logo {
	width: 40px;
	height: 40px;
}

/* Navigation - minimal placeholder */
.nav {
	display: flex;
	gap: 1.5rem;
	list-style: none;
	margin: 0;
	padding: 0;
	font-family: var(--font-display);
	font-size: 0.9rem;
}

.nav a {
	text-decoration: none;
}

.nav a:hover {
	text-decoration: underline;
}

/* Footer */
footer {
	padding: var(--page-pad);
	border-top: 1px solid var(--rule);
	text-align: center;
	font-size: 0.9rem;
	color: var(--ink-2);
}

/* Accessibility */
.visually-hidden {
	position: absolute;
	width: 1px;
	height: 1px;
	padding: 0;
	margin: -1px;
	overflow: hidden;
	clip: rect(0, 0, 0, 0);
	white-space: nowrap;
	border: 0;
}

/* ==========================================================================
   Post Layout
   ========================================================================== */

.post {
	max-width: var(--measure);
	margin-left: auto;
	margin-right: auto;
}

.post-header {
	margin-bottom: 2rem;
}

.post-title {
	font-size: clamp(1.75rem, 4vw, 2.5rem);
	margin: 0 0 0.5rem;
}

.post-metadata {
	list-style: none;
	padding: 0;
	margin: 0;
	font-family: var(--font-display);
	font-size: 0.9rem;
	color: var(--ink-2);
	display: flex;
	gap: 1rem;
}

.post-body {
	position: relative;
}

/* Post navigation */
.post-nav {
	margin-top: 3rem;
	padding-top: 1.5rem;
	border-top: 1px solid var(--rule);
}

.links-nextprev {
	display: flex;
	justify-content: space-between;
	list-style: none;
	padding: 0;
	margin: 0;
	font-family: var(--font-display);
	font-size: 0.9rem;
}

/* ==========================================================================
   Margin Notes
   ==========================================================================

   Two formats supported:

   1. Shortcode format ({% mn "anchor" %}...{% endmn %}):
      <span class="mn-ref">
        <span class="mn-anchor">anchor text</span>
        <span class="mn-note">Note content</span>
      </span>

   2. Shortcode marker format ({% mn %}...{% endmn %}):
      <span class="mn-ref">
        <sup class="mn-marker">1</sup>
        <span class="mn-note">Note content</span>
      </span>

   Desktop: Notes float into right margin
   Mobile: Notes inline, hidden until toggled
*/

/* Wrapper keeps note positioned relative to anchor on mobile only */
/* On desktop, we want notes to position relative to .post-body, not .mn-ref */
.mn-ref {
	position: relative;
}

@media (min-width: 768px) {
	.mn-ref {
		position: static;
	}
}

/* Anchor text style (when using anchor version) */
.mn-anchor {
	color: var(--ink);
	text-decoration: underline;
	text-decoration-color: var(--vermillion);
	text-decoration-style: dotted;
	text-decoration-thickness: 1px;
	text-underline-offset: 0.15em;
	cursor: pointer;
}

.mn-anchor:hover,
.mn-anchor:focus {
	text-decoration-style: solid;
}

.mn-anchor:focus {
	outline: 2px solid var(--vermillion);
	outline-offset: 2px;
}

/* Superscripted numeral after anchor text */
.mn-anchor-num {
	font-family: var(--font-display);
	font-size: 0.7em;
	font-weight: 600;
	color: var(--vermillion);
	vertical-align: super;
	line-height: 0;
	margin-left: 0.1em;
	text-decoration: none;
}

/* Numbered marker style (when using marker version) */
.mn-marker {
	font-family: var(--font-display);
	font-size: 0.75em;
	font-weight: 600;
	color: var(--vermillion);
	cursor: pointer;
	text-decoration: none;
	vertical-align: super;
	line-height: 0;
	padding: 0 0.1em;
}

.mn-marker:hover,
.mn-marker:focus {
	color: var(--ink);
}

.mn-marker:focus {
	outline: 2px solid var(--vermillion);
	outline-offset: 2px;
}

/* The note content */
.mn-note {
	font-family: var(--font-mn);
	font-size: 0.85rem;
	line-height: 1.5;
	color: var(--ink-2);
}

.mn-note-number {
	font-family: var(--font-display);
	font-weight: 600;
	color: var(--vermillion);
	font-size: 0.9em;
	margin-right: 0.25em;
}

.mn-note p {
	margin: 0 0 0.5em;
}

.mn-note p:last-child {
	margin-bottom: 0;
}

/* CJK in margin notes: no italics */
.mn-note em:lang(zh),
.mn-note em:lang(zh-Hans),
.mn-note em:lang(zh-Hant),
.mn-note i:lang(zh),
.mn-note i:lang(zh-Hans),
.mn-note i:lang(zh-Hant),
.mn-note em:lang(ja),
.mn-note i:lang(ja),
.mn-note em:lang(ko),
.mn-note i:lang(ko) {
	font-style: normal;
}

.mn-note :is(em, i) :is([lang^="zh"], [lang^="ja"], [lang^="ko"]) {
	font-style: normal;
}

/* --- Mobile: Notes hidden by default, shown on toggle --- */
@media (max-width: 767px) {
	.mn-note {
		display: none;
	}

	.mn-note.is-visible {
		/* Display as block on its own line below the anchor */
		display: block;
		margin: 0.75em 0;
		padding: 0.75em 1em;
		background: var(--paper-2);
		border-left: 3px solid var(--vermillion);
		border-radius: 0 4px 4px 0;
	}
}

/* --- Tablet & Desktop: Notes in margin --- */
@media (min-width: 768px) {
	/* Ensure post body has space for margin notes */
	.post-body {
		margin-right: calc(var(--mn-width) + var(--mn-gap));
	}

	.mn-note {
		position: absolute;
		right: calc(-1 * (var(--mn-width) + var(--mn-gap)));
		width: var(--mn-width);
		margin-top: 0;
		top: 0;
	}

	/* Anchor doesn't need indicator on desktop - note is visible */
	.mn-anchor {
		text-decoration-style: dotted;
		cursor: default;
	}
}

/* ==========================================================================
   Figures & Images
   ========================================================================== */

figure {
	margin: 1.5em 0;
	padding: 0;
}

figcaption {
	font-family: var(--font-mn);
	font-size: 0.85rem;
	color: var(--ink-2);
	margin-top: 0.5em;
	text-align: right;
}

/* Wide images - break out of column */
.fig-wide {
	margin-left: -2rem;
	margin-right: calc(-1 * (var(--mn-width) + var(--mn-gap) + 2rem));
}

.fig-wide figcaption {
	text-align: center;
}

/* Full-width images */
.fig-full {
	width: 100vw;
	margin-left: calc(-50vw + 50%);
}

.fig-full figcaption {
	text-align: center;
	max-width: var(--measure);
	margin: 0.5em auto 0;
}

/* ==========================================================================
   Poetry / Verse
   ========================================================================== */

.poem {
	margin: 1.5em 0;
}

.poem pre {
	background: none;
	padding: 0;
	white-space: pre-wrap;
	font-family: var(--font-body);
}

/* ==========================================================================
   Homepage - Simple Post List
   ========================================================================== */

.post-list {
	list-style: none;
	padding: 0;
	margin: 2rem 0;
}

.post-list li {
	margin-bottom: 1.5rem;
	padding-bottom: 1.5rem;
	border-bottom: 1px solid var(--paper-2);
}

.post-list li:last-child {
	border-bottom: none;
}

.post-list-title {
	font-family: var(--font-display);
	font-size: 1.25rem;
	font-weight: 700;
	margin: 0 0 0.25rem;
}

.post-list-title a {
	text-decoration: none;
}

.post-list-title a:hover {
	text-decoration: underline;
}

.post-list-meta {
	font-family: var(--font-display);
	font-size: 0.85rem;
	color: var(--ink-2);
	margin: 0;
}

/* ==========================================================================
   Print Styles
   ========================================================================== */

@media print {
	body {
		font-size: 11pt;
		line-height: 1.5;
		color: black;
		background: white;
	}

	header,
	footer,
	.post-nav {
		display: none;
	}

	main {
		max-width: none;
		padding: 0;
	}

	.post {
		transform: none;
	}

	.post-body {
		margin-right: 0;
	}

	/* Print margin notes inline */
	.mn-marker {
		color: black;
	}

	.mn-note {
		position: static;
		width: auto;
		display: block;
		margin: 0.5em 0 0.5em 2em;
		padding: 0.5em;
		border-left: 2px solid #666;
		font-size: 0.9em;
		color: #333;
	}

	.mn-note::before {
		content: "Note: ";
		font-weight: 600;
	}

	a {
		color: black;
		text-decoration: underline;
	}

	a[href^="http"]::after {
		content: " (" attr(href) ")";
		font-size: 0.8em;
		color: #666;
	}
}
