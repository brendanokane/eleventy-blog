/*
 * Burning House - Minimal CSS
 * Rebuilt from scratch, January 2026
 *
 * Breakpoints:
 *   - Mobile: < 1024px (single column, notes inline)
 *   - Desktop: >= 1024px (main column with right margin for notes)
 */

/* ==========================================================================
   Variables & Dark Mode
   ========================================================================== */

:root {
	/* Palette */
	--paper: #f6f0e8;
	--paper-2: #efe6db;
	--ink: #241425;
	--ink-2: #3a223a;
	--vermillion: #8f1d14;
	--rule: #241425;

	/* Typography */
	--font-body:
		"Vollkorn", "Noto Serif TC", "Source Han Serif TC", ui-serif, Georgia, serif;
	--font-display:
		"Source Sans 3", "Noto Sans TC", ui-sans-serif, system-ui, sans-serif;
	--font-mn:
		"Gill Sans", "Lato", "Noto Sans TC", ui-sans-serif, system-ui, sans-serif;

	--text-size: 1.375rem; /* 22px at 100% = 16px base */
	--leading: 1.65;
	--measure: 67ch;

	/* Layout */
	--page-pad: clamp(1rem, 3vw, 2rem);
	--main-col: minmax(0, var(--measure));
	--margin-col: 240px;
	--margin-gap: 2rem;
}

@media (prefers-color-scheme: dark) {
	:root {
		--paper: #1a1a1a;
		--paper-2: #242424;
		--ink: #e8e0d8;
		--ink-2: #c0b8b0;
		--vermillion: #e85a4f;
		--rule: #e8e0d8;
	}
}

/* ==========================================================================
   Base Elements
   ========================================================================== */

html {
	font-size: 100%;
	scroll-behavior: smooth;
}

body {
	font-family: var(--font-body);
	font-size: var(--text-size);
	line-height: var(--leading);
	color: var(--ink);
	background: var(--paper);
	margin: 0;
	padding: 0;
	-webkit-font-smoothing: antialiased;
}

/* Links */
a {
	color: var(--ink);
	text-decoration: underline;
	text-decoration-color: var(--vermillion);
	text-underline-offset: 0.15em;
	text-decoration-thickness: 1.5px;
}
a:visited {
	color: var(--ink-2);
}
a:hover {
	text-decoration-thickness: 2px;
}

/* Headings */
h1,
h2,
h3,
h4 {
	font-family: var(--font-display);
	font-weight: 700;
	line-height: 1.2;
	margin: 1.5em 0 0.5em;
}
h1 {
	font-size: 2rem;
}
h2 {
	font-size: 1.5rem;
}
h3 {
	font-size: 1.25rem;
}
h4 {
	font-size: 1.1rem;
}

/* Paragraphs, Blockquotes, etc. */
p {
	margin: 0 0 1em;
}
blockquote {
	margin: 1.5em 0;
	padding-left: 2em;
	border: none;
	font-style: normal;
}
pre,
code {
	font-family: var(--font-body);
	font-size: 0.95em;
}
pre {
	overflow-x: auto;
	padding: 1em;
	background: var(--paper-2);
	border-radius: 4px;
}
img {
	max-width: 100%;
	height: auto;
	display: block;
}
hr {
	border: none;
	border-top: 1px solid var(--rule);
	margin: 2em 0;
}

/* CJK: Never italicize */
em:lang(zh),
i:lang(zh),
em:lang(ja),
i:lang(ja),
em:lang(ko),
i:lang(ko) {
	font-style: normal;
}
:is(em, i) :is([lang^="zh"], [lang^="ja"], [lang^="ko"]) {
	font-style: normal;
}

/* ==========================================================================
   Main Layout
   ========================================================================== */

.site-header-container,
.main-content-container,
.site-footer-container {
	padding: var(--page-pad);
}

.site-header {
	max-width: var(--measure);
	margin: 0 auto;
	display: flex;
	justify-content: space-between;
	align-items: center;
	border-bottom: 1px solid var(--rule);
	padding-bottom: 1rem;
}

.home-link {
	display: flex;
	align-items: center;
	gap: 0.75rem;
	font-family: var(--font-display);
	font-weight: 700;
	font-size: 1.1rem;
	text-decoration: none;
}
.site-logo {
	width: 40px;
	height: 40px;
}

.nav {
	display: flex;
	gap: 1.5rem;
	list-style: none;
	margin: 0;
	padding: 0;
	font-family: var(--font-display);
	font-size: 0.9rem;
}
.nav a {
	text-decoration: none;
}
.nav a:hover {
	text-decoration: underline;
}

.site-footer {
	max-width: var(--measure);
	margin: 0 auto;
	padding-top: 1.5rem;
	border-top: 1px solid var(--rule);
	text-align: center;
	font-size: 0.9rem;
	color: var(--ink-2);
}

/* ==========================================================================
   Post Layout
   ========================================================================== */

/* This container uses grid to create the main content column and margin column */
.layout-container {
	display: grid;
	grid-template-columns: 1fr; /* Mobile-first: single column */
	justify-content: center;
	padding: var(--page-pad);
}

.post {
	grid-column: 1;
	max-width: var(--measure);
	justify-self: center; /* Center the post content within the grid area */
}

/* On desktop, create the margin column */
@media (min-width: 1024px) {
	.layout-container {
		grid-template-columns:
			1fr var(--main-col) var(--margin-gap) var(--margin-col)
			1fr;
	}
	.post {
		grid-column: 2;
	}
}

.post-header {
	margin-bottom: 2rem;
}
.post-title {
	font-size: clamp(1.75rem, 4vw, 2.5rem);
	margin: 0 0 0.5rem;
}

.post-metadata {
	list-style: none;
	padding: 0;
	margin: 0;
	font-family: var(--font-display);
	font-size: 0.9rem;
	color: var(--ink-2);
	display: flex;
	gap: 1rem;
}

.post-body {
	position: relative; /* Parent for positioning margin notes */
}

/* Post navigation */
.post-nav {
	margin-top: 3rem;
	padding-top: 1.5rem;
	border-top: 1px solid var(--rule);
}
.links-nextprev {
	display: flex;
	justify-content: space-between;
	list-style: none;
	padding: 0;
	margin: 0;
	font-family: var(--font-display);
	font-size: 0.9rem;
}

/* ==========================================================================
   Margin & Foot Notes
   ========================================================================== */

.mn-ref,
.fn-ref {
	position: relative;
} /* Mobile positioning context */

.mn-anchor {
	color: var(--ink);
	text-decoration: underline;
	text-decoration-color: var(--vermillion);
	text-decoration-style: dotted;
	text-decoration-thickness: 1px;
	text-underline-offset: 0.15em;
	cursor: pointer;
	font-style: normal; /* Don't inherit italic from parent */
}
.mn-anchor:hover,
.mn-anchor:focus {
	text-decoration-style: solid;
}
.mn-anchor:focus {
	outline: 2px solid var(--vermillion);
	outline-offset: 2px;
}

.mn-anchor-num,
.fn-anchor-num sup {
	font-family: var(--font-display);
	font-size: 0.7em;
	font-weight: 600;
	color: var(--vermillion);
	vertical-align: super;
	line-height: 0;
	margin-left: 0.1em;
	text-decoration: none;
	font-style: normal; /* Don't inherit italic from parent */
}

.mn-marker,
.fn-marker,
.fn-marker a {
	font-family: var(--font-display);
	font-size: 0.75em;
	font-weight: 600;
	color: var(
		--vermillion
	) !important; /* Override link color and inherited styles */
	font-style: normal !important; /* Don't inherit italic from parent */
	cursor: pointer;
	text-decoration: none !important;
	vertical-align: super;
	line-height: 1; /* Prevent affecting parent line height */
	padding: 0 0.1em;
}
/* Ensure sup wrapper doesn't affect line height */
sup.fn-ref {
	line-height: 0;
	vertical-align: baseline;
}
sup.fn-ref a {
	vertical-align: super;
}
.mn-marker:hover,
.mn-marker:focus,
.fn-marker:hover,
.fn-marker:focus,
.fn-marker a:hover,
.fn-marker a:focus {
	color: var(--ink) !important;
}
.mn-marker:focus,
.fn-marker:focus,
.fn-marker a:focus {
	outline: 2px solid var(--vermillion);
	outline-offset: 2px;
}

.mn-note {
	/* Note: display is set per breakpoint - see mobile/desktop media queries below */
	font-family: var(--font-mn);
	font-size: 0.85rem;
	line-height: 1.5;
	color: var(--ink-2);
	font-style: normal; /* Don't inherit italic from parent */
	position: relative;
	padding-left: 1.5em; /* Space for the number */
}
/* Margin note paragraphs and blockquotes - using span elements to avoid HTML nesting issues */
.mn-p {
	display: block;
	margin: 0.35em 0;
}
.mn-p:first-child {
	margin-top: 0;
}
.mn-p:last-child {
	margin-bottom: 0;
}
.mn-p + .mn-p {
	margin-top: 0.35em; /* Tighter spacing between consecutive paragraphs */
}
.mn-blockquote {
	display: block;
	margin: 0.5em 0;
	padding-left: 0.75em;
	border-left: none; /* Indentation indicates quotation, border unnecessary */
	opacity: 0.9;
}
.mn-blockquote .mn-p {
	margin: 0.25em 0; /* Even tighter inside blockquotes */
}
.mn-note-number {
	font-family: var(--font-display);
	font-weight: 600;
	color: var(--vermillion);
	font-size: 0.9em;
	position: absolute;
	left: 0;
	margin-right: 0;
}
.mn-note p {
	margin: 0 0 0.5em;
}
.mn-note p:last-child {
	margin-bottom: 0;
}
.mn-note em:lang(zh),
.mn-note i:lang(zh),
.mn-note em:lang(ja),
.mn-note i:lang(ja),
.mn-note em:lang(ko),
.mn-note i:lang(ko) {
	font-style: normal;
}
.mn-note :is(em, i) :is([lang^="zh"], [lang^="ja"], [lang^="ko"]) {
	font-style: normal;
}

/* --- Mobile: Notes hidden by default, shown on toggle --- */
@media (max-width: 1023px) {
	/* Prevent horizontal overflow */
	body {
		overflow-x: hidden;
	}

	/* Reset layout for mobile - no character-based measure, just fill available space */
	.layout-container {
		padding: 1rem; /* Simpler padding than clamp */
		overflow-x: hidden;
	}

	.post {
		max-width: none; /* Remove 67ch limit */
		width: 100%;
		margin: 0; /* Remove any margin */
		overflow-x: hidden;
	}

	.post-body {
		max-width: none; /* Ensure body also doesn't constrain */
		overflow-x: hidden;
	}

	/* Ensure all children respect viewport width */
	.post-body * {
		max-width: 100%;
	}

	.mn-note {
		display: none !important; /* !important to override base styles */
		position: static; /* Reset absolute positioning from desktop */
		width: auto;
	}

	.mn-note.is-visible {
		display: block !important; /* !important to ensure visibility when toggled */
		margin: 0.75em 0;
		padding: 0.75em 1em 0.75em 2.5em; /* Extra left padding for note number */
		background: var(--paper-2);
		border-left: none; /* Remove border - font and background distinguish notes */
		border-radius: 4px; /* Rounded on all sides without left border */
		position: static; /* Inline with content, not absolute */
		width: auto;
		left: auto; /* Reset desktop positioning */
		top: auto;
	}

	/* Ensure text inside visible notes has proper contrast */
	.mn-note.is-visible .mn-p,
	.mn-note.is-visible .mn-blockquote {
		color: var(--ink);
	}
}

/* --- Desktop: Notes in margin --- */
@media (min-width: 1024px) {
	/* This is the key fix: by making the reference static on desktop,
	 * the note inside is positioned relative to .post-body, not the marker. */
	.mn-ref,
	.fn-ref {
		position: static;
	}

	.mn-note {
		display: block; /* Allow block-level children on desktop */
		position: absolute;
		left: calc(100% + var(--margin-gap));
		width: var(--margin-col);
		top: -3px; /* User-suggested value for vertical alignment */
	}
	.mn-anchor {
		text-decoration-style: dotted;
		cursor: default;
	}
}

/* Footnotes Section */
.footnotes {
	margin-top: 3rem;
}
.footnotes-separator {
	width: 100px;
	margin: 2rem auto;
}
.footnotes-title {
	text-align: center;
	font-size: 1.25rem;
}
.footnotes-list {
	padding: 0;
	list-style: none;
	font-family: var(--font-mn);
	font-size: 0.85rem;
	line-height: 1.6;
	color: var(--ink-2);
	counter-reset: footnote;
}
.footnotes-list > li {
	margin-bottom: 1em;
	position: relative;
	padding-left: 1.5em; /* Space for the number */
	counter-increment: footnote;
}
.footnotes-list > li::before {
	content: counter(footnote) ".";
	font-family: var(--font-display);
	font-weight: 600;
	color: var(--vermillion);
	position: absolute;
	left: 0;
}
/* Nested lists within footnotes should display normally */
.footnotes-list li ul,
.footnotes-list li ol {
	margin-top: 0.5em;
	padding-left: 1.5em;
}
.footnotes-list li ul li,
.footnotes-list li ol li {
	padding-left: 0;
}
.footnotes-list li ul {
	list-style: disc;
}
.footnotes-list li ol {
	list-style: decimal;
}
.footnote-backref {
	margin-left: 0.25em;
	text-decoration: none;
	font-size: 0.9em;
}
.footnote-backref::before {
	content: "\00A0\00A0"; /* Two non-breaking spaces */
}

/* ==========================================================================
   Figures & Images
   ========================================================================== */

figure {
	margin: 1.5em 0;
	padding: 0;
}
figcaption {
	font-family: var(--font-mn);
	font-size: 0.85rem;
	color: var(--ink-2);
	margin-top: 0.5em;
	text-align: right;
}

/* Figure with margin caption */
@media (min-width: 1024px) {
	.fig-margin {
		position: relative;
	}
	.fig-caption-margin {
		position: absolute;
		left: calc(100% + var(--margin-gap));
		width: var(--margin-col);
		top: 0;
	}
}

/* Figure with centered caption */
.fig-centered {
	text-align: center;
}
.fig-centered figcaption {
	text-align: center;
}

/* Wide and full-width images */
.fig-wide {
	width: calc(var(--measure) + var(--margin-col) + var(--margin-gap));
	max-width: none;
	margin-left: 0;
	margin-right: 0;
}
.fig-full {
	width: 100vw;
	max-width: 100vw;
	margin-left: 50%;
	transform: translateX(-50%);
}
.fig-wide figcaption,
.fig-full figcaption {
	max-width: var(--measure);
	margin: 0.5em auto 0;
	text-align: center;
}

/* ==========================================================================
   Poems
   ========================================================================== */

.poem-container {
	margin: 2em 0;
	padding: 1.5em 0;
	border-top: 1px solid var(--rule);
	border-bottom: 1px solid var(--rule);
}

.poem-header {
	margin-bottom: 1.5em;
	text-align: center;
}

.poem-title-zh {
	font-family: "Noto Serif TC", "Source Han Serif TC", var(--font-body);
	font-size: 1.5rem;
	font-weight: 600;
	margin: 0 0 0.25em;
	line-height: 1.3;
}

.poem-poet-zh {
	font-family: "Noto Sans TC", var(--font-display);
	font-size: 0.95rem;
	color: var(--ink-2);
	margin: 0 0 0.75em;
}

.poem-title-en {
	font-family: var(--font-display);
	font-size: 1.1rem;
	font-weight: 600;
	font-style: italic;
	margin: 0 0 0.25em;
}

.poem-poet-en {
	font-family: var(--font-display);
	font-size: 0.85rem;
	color: var(--ink-2);
	margin: 0;
}

.poem-body {
	display: flex;
	flex-direction: column;
	gap: 1.5em;
}

.poem-text-zh {
	font-family: "Noto Serif TC", "Source Han Serif TC", var(--font-body);
	font-size: 1.25rem;
	line-height: 1.8;
	text-align: center;
}

.poem-text-en {
	font-family: var(--font-body);
	font-size: 1rem;
	line-height: 1.7;
	font-style: italic;
	text-align: center;
	color: var(--ink-2);
}

/* Desktop: side-by-side layout */
@media (min-width: 1024px) {
	.poem-body {
		flex-direction: row;
		gap: 2em;
		justify-content: center;
	}

	.poem-text-zh,
	.poem-text-en {
		flex: 0 1 auto;
		max-width: 45%;
		text-align: left;
	}

	.poem-text-zh {
		text-align: right;
		padding-right: 1em;
		border-right: 1px solid var(--paper-2);
	}

	.poem-text-en {
		padding-left: 1em;
	}
}

/* Error state for missing poems */
.poem-error {
	font-family: var(--font-display);
	font-size: 0.9rem;
}

/* ==========================================================================
   Homepage - Simple Post List
   ========================================================================== */
.posts-list-container {
	max-width: var(--measure);
	margin: 0 auto;
	padding: var(--page-pad);
}
.post-list {
	list-style: none;
	padding: 0;
	margin: 2rem 0;
}
.post-list li {
	margin-bottom: 1.5rem;
	padding-bottom: 1.5rem;
	border-bottom: 1px solid var(--paper-2);
}
.post-list li:last-child {
	border-bottom: none;
}
.post-list-title {
	font-family: var(--font-display);
	font-size: 1.25rem;
	font-weight: 700;
	margin: 0 0 0.25rem;
}
.post-list-title a {
	text-decoration: none;
}
.post-list-title a:hover {
	text-decoration: underline;
}
.post-list-meta {
	font-family: var(--font-display);
	font-size: 0.85rem;
	color: var(--ink-2);
	margin: 0;
}

/* ==========================================================================
   Print Styles
   ========================================================================== */

@media print {
	body {
		font-size: 11pt;
		line-height: 1.5;
		color: black;
		background: white;
	}
	.site-header-container,
	.site-footer-container,
	.post-nav {
		display: none;
	}
	.layout-container {
		display: block;
		padding: 0;
	}
	.post {
		max-width: 100%;
	}
	.mn-note {
		position: static;
		width: auto;
		display: block;
		margin: 0.5em 0 0.5em 2em;
		padding: 0.5em;
		border-left: 2px solid #666;
		font-size: 0.9em;
		color: #333;
	}
	.mn-note::before {
		content: "Note: ";
		font-weight: 600;
	}
	a {
		color: black;
		text-decoration: underline;
	}
	a[href^="http"]::after {
		content: " (" attr(href) ")";
		font-size: 0.8em;
		color: #666;
	}
}
