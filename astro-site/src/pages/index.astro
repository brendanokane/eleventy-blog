---
/**
 * Homepage - Broadsheet / 日用類書 Inspired
 *
 * Layout:
 * - Hero: Most recent post (title, subtitle, excerpt)
 * - Recent 6: Posts with excerpts in two columns
 * - Archive link
 */

import { getCollection } from 'astro:content';
import HomeLayout from '../layouts/HomeLayout.astro';

const posts = await getCollection('blog');

// Sort by date, newest first
const sortedPosts = posts.sort((a, b) =>
  b.data.date.valueOf() - a.data.date.valueOf()
);

const heroPost = sortedPosts[0];
const recentPosts = sortedPosts.slice(1, 7); // Next 6 posts

function formatDate(date: Date) {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  });
}

function getExcerpt(post: any) {
  return post.data.description || post.data.social_description || '';
}
---

<HomeLayout title="Burning House">
  <div class="home-container">
      <!-- Masthead / Header -->
      <header class="broadsheet-header">
        <div class="header-rule"></div>
        <h1 class="site-title">Stories from a Burning House</h1>
        <p class="site-title-zh">燎齋誌異</p>
        <p class="site-tagline">Translations, commentary, and occasional verse</p>
        <div class="header-rule"></div>
      </header>

      <!-- Hero Post -->
      {heroPost && (
        <article class="hero-post">
          {heroPost.data.post_image && (
            <div class="hero-image">
              <a href={`/${heroPost.slug}`}>
                <img
                  src={heroPost.data.post_image}
                  alt={heroPost.data.post_image_alt || heroPost.data.title}
                  loading="eager"
                />
              </a>
            </div>
          )}

          <div class="hero-content">
            <div class="hero-meta">
              <time datetime={heroPost.data.date.toISOString()}>
                {formatDate(heroPost.data.date)}
              </time>
            </div>

            <h2 class="hero-title">
              <a href={`/${heroPost.slug}`}>{heroPost.data.title}</a>
            </h2>

            {heroPost.data.subtitle && (
              <p class="hero-subtitle">{heroPost.data.subtitle}</p>
            )}

            {getExcerpt(heroPost) && (
              <p class="hero-excerpt">{getExcerpt(heroPost)}</p>
            )}

            <a href={`/${heroPost.slug}`} class="hero-readmore">
              Read →
            </a>
          </div>
        </article>
      )}

      <!-- Rule -->
      <hr class="section-rule" />

      <!-- Recent Posts Grid -->
      <section class="recent-posts">
        <h2 class="section-heading">Recent</h2>

        <div class="posts-grid">
          {recentPosts.map((post) => (
            <article class="post-card">
              {post.data.post_image && (
                <div class="post-card-image">
                  <a href={`/${post.slug}`}>
                    <img
                      src={post.data.post_image}
                      alt={post.data.post_image_alt || post.data.title}
                      loading="lazy"
                    />
                  </a>
                </div>
              )}

              <div class="post-card-content">
                <time datetime={post.data.date.toISOString()}>
                  {formatDate(post.data.date)}
                </time>

                <h3>
                  <a href={`/${post.slug}`}>{post.data.title}</a>
                </h3>

                {post.data.subtitle && (
                  <p class="post-subtitle">{post.data.subtitle}</p>
                )}

                {getExcerpt(post) && (
                  <p class="post-excerpt">{getExcerpt(post)}</p>
                )}
              </div>
            </article>
          ))}
        </div>
      </section>

      <!-- Archive Link -->
      <div class="archive-link-container">
        <hr class="section-rule" />
        <p class="archive-link">
          <a href="/blog">View Full Archive →</a>
        </p>
      </div>
  </div>
</HomeLayout>

<style>
  /* Home Container - centered with max-width */
  .home-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 var(--page-pad, 1rem);
  }

  /* Broadsheet Header */
  .broadsheet-header {
    text-align: center;
    margin-bottom: var(--space-xl, 3rem);
    padding-top: var(--space-lg, 2rem);
  }

  .header-rule {
    height: 2px;
    background: var(--rule, #241425);
    margin: var(--space-md, 1.5rem) auto;
    max-width: 200px;
  }

  .site-title {
    font-family: var(--font-body);
    font-size: 2.5rem;
    font-weight: 600;
    letter-spacing: 0.05em;
    margin: 0;
    text-transform: uppercase;
  }

  .site-title-zh {
    font-family: var(--font-body);
    font-size: 1.8rem;
    font-weight: 400;
    letter-spacing: 0.2em;
    margin: var(--space-xs, 0.5rem) 0 0;
    color: var(--ink, #241425);
  }

  .site-tagline {
    font-family: var(--font-display);
    font-size: 1rem;
    font-style: italic;
    color: var(--ink-2, #3a223a);
    margin: var(--space-sm, 1rem) 0 0;
  }

  /* Hero Post */
  .hero-post {
    margin-bottom: var(--space-xl, 3rem);
  }

  @media (min-width: 768px) {
    .hero-post {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: var(--space-xl, 3rem);
      align-items: start;
    }
  }

  .hero-image {
    margin-bottom: var(--space-lg, 2rem);
  }

  @media (min-width: 768px) {
    .hero-image {
      margin-bottom: 0;
    }
  }

  .hero-image img {
    width: 100%;
    height: auto;
    display: block;
    border: 1px solid var(--rule, #ddd);
  }

  .hero-image a:hover img {
    opacity: 0.9;
  }

  .hero-content {
    /* Content fills remaining space in grid */
  }

  .hero-meta {
    font-family: var(--font-display);
    font-size: 0.9rem;
    color: var(--ink-2, #3a223a);
    margin-bottom: var(--space-sm, 1rem);
  }

  .hero-title {
    font-size: 2rem;
    line-height: 1.3;
    margin-bottom: var(--space-sm, 1rem);
  }

  .hero-title a {
    color: var(--ink, #241425);
    text-decoration: none;
  }

  .hero-title a:hover {
    color: var(--vermillion, #8f1d14);
  }

  .hero-subtitle {
    font-family: var(--font-display);
    font-size: 1.2rem;
    font-style: italic;
    color: var(--ink-2, #3a223a);
    margin-bottom: var(--space-md, 1.5rem);
  }

  .hero-excerpt {
    font-size: 1.1rem;
    line-height: 1.6;
    margin-bottom: var(--space-md, 1.5rem);
    color: var(--ink-2, #3a223a);
  }

  .hero-readmore {
    font-family: var(--font-display);
    font-weight: 600;
    color: var(--vermillion, #8f1d14);
    text-decoration: none;
    font-size: 0.95rem;
    letter-spacing: 0.05em;
  }

  .hero-readmore:hover {
    text-decoration: underline;
  }

  /* Section Styling */
  .section-rule {
    border: none;
    border-top: 1px solid var(--rule, #ddd);
    margin: var(--space-xl, 3rem) 0;
  }

  .section-heading {
    font-family: var(--font-display);
    font-size: 1.2rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: var(--space-lg, 2rem);
    text-align: center;
  }

  /* Posts Grid */
  .posts-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: var(--space-xl, 3rem);
    margin-bottom: var(--space-xl, 3rem);
  }

  @media (min-width: 768px) {
    .posts-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-lg, 2rem) var(--space-xl, 3rem);
    }
  }

  .post-card {
    display: flex;
    flex-direction: column;
    padding-bottom: var(--space-lg, 2rem);
    border-bottom: 1px solid var(--rule, #ddd);
  }

  @media (min-width: 768px) {
    .post-card {
      border-bottom: none;
    }
  }

  .post-card-image {
    margin-bottom: var(--space-md, 1.5rem);
    order: -1; /* Image always appears first */
  }

  .post-card-image img {
    width: 100%;
    height: auto;
    aspect-ratio: 16 / 9;
    object-fit: cover;
    display: block;
    border: 1px solid var(--rule, #ddd);
  }

  .post-card-image a:hover img {
    opacity: 0.9;
  }

  .post-card-content {
    /* Contains text content */
  }

  .post-card time {
    font-family: var(--font-display);
    font-size: 0.85rem;
    color: var(--ink-2, #3a223a);
    display: block;
    margin-bottom: var(--space-xs, 0.5rem);
  }

  .post-card h3 {
    font-size: 1.3rem;
    line-height: 1.3;
    margin-bottom: var(--space-xs, 0.5rem);
  }

  .post-card h3 a {
    color: var(--ink, #241425);
    text-decoration: none;
  }

  .post-card h3 a:hover {
    color: var(--vermillion, #8f1d14);
  }

  .post-subtitle {
    font-family: var(--font-display);
    font-style: italic;
    font-size: 0.95rem;
    color: var(--ink-2, #3a223a);
    margin-bottom: var(--space-sm, 1rem);
  }

  .post-excerpt {
    font-size: 0.95rem;
    line-height: 1.5;
    color: var(--ink-2, #3a223a);
  }

  /* Archive Link */
  .archive-link-container {
    text-align: center;
  }

  .archive-link {
    font-family: var(--font-display);
    font-size: 1.1rem;
    margin-top: var(--space-lg, 2rem);
  }

  .archive-link a {
    color: var(--vermillion, #8f1d14);
    text-decoration: none;
    font-weight: 600;
    letter-spacing: 0.05em;
  }

  .archive-link a:hover {
    text-decoration: underline;
  }
</style>
