---
/**
 * Email Layout
 *
 * Renders blog posts for email/RSS with:
 * - Inline CSS (email-safe)
 * - CSS variables matching site design
 * - Margin notes → endnotes transformation
 * - Graceful plain-text degradation
 * - Compatible with Buttondown's Modern template
 *
 * Design system (from css/index.css):
 * - Colors: --paper (#f6f0e8), --ink (#241425), --vermillion (#8f1d14)
 * - Fonts: serif for body (Vollkorn fallback to Georgia), sans for UI (Source Sans fallback to system)
 * - Typography: 22px base, 1.65 line-height, 60ch measure
 */

interface Props {
  title: string;
  date: Date;
  description?: string;
}

const { title, date, description } = Astro.props;

// Format date for email
const dateStr = date.toLocaleDateString('en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});
---

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  <title>{title}</title>
  {description && <meta name="description" content={description}>}

  <style>
    /*
     * Email-safe CSS with design system variables
     * Inline styles for maximum compatibility
     * Graceful degradation to plain text
     */

    :root {
      /* Color palette - light mode base */
      --paper: #f6f0e8;
      --ink: #241425;
      --ink-muted: #3a223a;
      --vermillion: #8f1d14;
      --rule: #ddd;

      /* Typography - email-safe fallbacks only */
      --font-body: Georgia, 'Times New Roman', serif;
      --font-sans: 'Helvetica Neue', Helvetica, Arial, sans-serif;

      /* Spacing rhythm */
      --space-xs: 0.5rem;
      --space-sm: 1rem;
      --space-md: 1.5rem;
      --space-lg: 2rem;
      --space-xl: 3rem;
    }

    /* Dark mode support (many email clients don't support, but graceful) */
    @media (prefers-color-scheme: dark) {
      :root {
        --paper: #1a1a1a;
        --ink: #e8e0d8;
        --ink-muted: #c0b8b0;
        --vermillion: #e85a4f;
        --rule: #444;
      }
    }

    /* Base reset for email clients */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: var(--font-body);
      font-size: 18px; /* Slightly smaller for email */
      line-height: 1.6;
      color: var(--ink);
      background-color: var(--paper);
      max-width: 600px; /* Email-safe max-width */
      margin: 0 auto;
      padding: var(--space-lg) var(--space-md);
    }

    /* Header */
    .email-header {
      margin-bottom: var(--space-xl);
      padding-bottom: var(--space-lg);
      border-bottom: 1px solid var(--rule);
    }

    .email-title {
      font-family: var(--font-body);
      font-size: 1.75rem;
      font-weight: 600;
      line-height: 1.3;
      color: var(--ink);
      margin-bottom: var(--space-sm);
    }

    .email-meta {
      font-family: var(--font-sans);
      font-size: 0.9rem;
      color: var(--ink-muted);
    }

    /* Main content */
    .email-content {
      margin-bottom: var(--space-xl);
    }

    .email-content p {
      margin-bottom: var(--space-md);
    }

    .email-content h2 {
      font-size: 1.4rem;
      font-weight: 600;
      margin-top: var(--space-xl);
      margin-bottom: var(--space-md);
      color: var(--ink);
    }

    .email-content h3 {
      font-size: 1.2rem;
      font-weight: 600;
      margin-top: var(--space-lg);
      margin-bottom: var(--space-sm);
      color: var(--ink);
    }

    /* Links */
    a {
      color: var(--vermillion);
      text-decoration: underline;
    }

    a:hover {
      text-decoration: none;
    }

    /* Superscript note references */
    sup {
      line-height: 0;
      font-size: 0.75em;
    }

    sup a {
      text-decoration: none;
      font-weight: 600;
      padding: 0 0.15em;
    }

    /* Blockquotes */
    blockquote {
      margin: var(--space-md) 0;
      padding-left: var(--space-md);
      border-left: 3px solid var(--rule);
      font-style: italic;
      color: var(--ink-muted);
    }

    /* Code */
    code {
      font-family: 'Courier New', Courier, monospace;
      font-size: 0.9em;
      background-color: var(--rule);
      padding: 0.15em 0.3em;
      border-radius: 3px;
    }

    pre {
      margin: var(--space-md) 0;
      padding: var(--space-md);
      background-color: var(--rule);
      border-radius: 3px;
      overflow-x: auto;
    }

    pre code {
      background: none;
      padding: 0;
    }

    /* Images */
    img {
      max-width: 100%;
      height: auto;
      display: block;
      margin: var(--space-lg) auto;
    }

    figure {
      margin: var(--space-lg) 0;
    }

    figcaption {
      font-family: var(--font-sans);
      font-size: 0.85rem;
      color: var(--ink-muted);
      margin-top: var(--space-xs);
      text-align: center;
    }

    /* Endnotes section */
    .endnotes {
      margin-top: var(--space-xl);
      padding-top: var(--space-lg);
      border-top: 1px solid var(--rule);
    }

    .endnotes-title {
      font-family: var(--font-sans);
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: var(--space-md);
      color: var(--ink);
    }

    .endnote {
      font-family: var(--font-sans);
      font-size: 0.9rem;
      line-height: 1.5;
      margin-bottom: var(--space-md);
      color: var(--ink-muted);
    }

    .endnote-number {
      font-weight: 600;
      color: var(--vermillion);
      margin-right: var(--space-xs);
    }

    .endnote a.backref {
      text-decoration: none;
      margin-left: var(--space-xs);
      font-size: 0.9em;
    }

    /* Footer */
    .email-footer {
      margin-top: var(--space-xl);
      padding-top: var(--space-lg);
      border-top: 1px solid var(--rule);
      font-family: var(--font-sans);
      font-size: 0.85rem;
      color: var(--ink-muted);
      text-align: center;
    }

    /* Horizontal rule */
    hr {
      border: none;
      border-top: 1px solid var(--rule);
      margin: var(--space-lg) 0;
    }

    /* Lists */
    ul, ol {
      margin-bottom: var(--space-md);
      padding-left: var(--space-lg);
    }

    li {
      margin-bottom: var(--space-xs);
    }
  </style>
</head>
<body>
  <article>
    <header class="email-header">
      <h1 class="email-title">{title}</h1>
      <div class="email-meta">
        <time datetime={date.toISOString()}>{dateStr}</time>
      </div>
    </header>

    <div class="email-content">
      <slot />
    </div>

    <!--
      Endnotes section
      In a full implementation, this would collect note content from EmailNote components.
      For now, this is a placeholder that can be populated via a transform or plugin.
    -->
    <aside class="endnotes" id="endnotes">
      <h2 class="endnotes-title">Notes</h2>
      <!-- Endnotes will be inserted here by build process or manually in MDX -->
      <slot name="endnotes" />
    </aside>

    <footer class="email-footer">
      <p>
        <a href="https://burninghou.se">Burning House</a> ·
        <a href="https://burninghou.se/{Astro.url.pathname}">Read online</a>
      </p>
    </footer>
  </article>
</body>
</html>
