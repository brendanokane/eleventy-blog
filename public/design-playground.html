<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Design Playground ‚Äì Burning House</title>
<link href="https://fonts.googleapis.com/css2?family=Alegreya:ital,wght@0,400..900;1,400..900&family=Alegreya+Sans:ital,wght@0,100..900;1,100..900&family=Vollkorn:ital,wght@0,400..900;1,400..900&family=Noto+Serif+TC:wght@200..900&family=Noto+Sans+TC:wght@100..900&family=Noto+Sans:ital,wght@0,100..900;1,100..900&family=Work+Sans:ital,wght@0,100..900;1,100..900&family=Inter:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: system-ui;
  background: #1a1a1a;
  color: #f0f0f0;
  overflow: hidden;
}

.container {
  display: grid;
  grid-template-columns: 320px 1fr;
  height: 100vh;
}

.controls {
  background: #2a2a2a;
  padding: 15px;
  overflow-y: auto;
  border-right: 1px solid #444;
  font-size: 0.85rem;
}

.controls h1 {
  font-size: 1.2rem;
  margin-bottom: 8px;
}

.controls h2 {
  font-size: 0.8rem;
  color: #aaa;
  text-transform: uppercase;
  margin: 18px 0 8px;
  border-bottom: 1px solid #444;
  padding-bottom: 4px;
}

.control {
  margin-bottom: 10px;
}

.control label {
  display: block;
  font-size: 0.75rem;
  color: #ccc;
  margin-bottom: 4px;
}

input[type=range] {
  width: 100%;
  height: 4px;
}

input[type=number] {
  width: 55px;
  padding: 3px;
  background: #1a1a1a;
  border: 1px solid #444;
  border-radius: 3px;
  color: #f0f0f0;
  font-size: 0.75rem;
}

input[type=color] {
  width: 100%;
  height: 28px;
  border: none;
  cursor: pointer;
}

select {
  width: 100%;
  padding: 5px;
  background: #1a1a1a;
  border: 1px solid #444;
  border-radius: 3px;
  color: #f0f0f0;
  font-size: 0.75rem;
}

button {
  width: 100%;
  padding: 10px;
  margin-top: 15px;
  background: #8f1d14;
  color: #fff;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: 600;
  font-size: 0.8rem;
}

button:hover {
  background: #a52218;
}

.preview {
  overflow-y: auto;
  padding: 40px 20px;
}

.wb-shell {
  max-width: 1400px;
  margin: 0 auto;
  padding: 2.5rem var(--shell-pad) 4rem;
}

.wb-frame {
  border-left: var(--border-weight) solid var(--ink);
  border-right: var(--border-weight) solid var(--ink);
  padding: 2rem var(--frame-pad);
  background: rgba(255, 255, 255, 0.35);
  overflow: hidden;
}

.wb-grid {
  position: relative;
  display: grid;
  grid-template-columns: minmax(0, var(--main-width)) var(--mn-width);
  gap: var(--column-gap);
  align-items: start;
}

.wb-prose {
  font-family: var(--font-body);
  font-size: var(--body-size);
  line-height: var(--body-line-height);
  color: var(--ink);
  grid-column: 1;
}

.wb-prose p {
  margin: 0 0 1.1em;
}

.wb-prose h1 {
  font-family: var(--font-display);
  font-size: var(--h1-size);
  line-height: var(--h1-line-height);
  margin: 0 0 0.6em;
  font-weight: 800;
  color: var(--ink);
}

.wb-prose h2 {
  font-family: var(--font-display);
  font-size: var(--h2-size);
  line-height: var(--h2-line-height);
  margin: 1.5em 0 0.5em;
  font-weight: 700;
  color: var(--ink);
}

.wb-prose blockquote {
  margin: 1.2em 0;
  padding-left: 1.1em;
  border-left: 2px solid var(--rule);
  color: var(--ink);
}

.wb-prose blockquote br {
  display: none;
}

.wb-prose em {
  font-style: italic;
}

/* Prevent Chinese characters from being italicized */
.wb-prose em:lang(zh),
.wb-prose em:lang(zh-Hans),
.wb-prose em:lang(zh-Hant),
.wb-prose i:lang(zh),
.wb-prose i:lang(zh-Hans),
.wb-prose i:lang(zh-Hant),
.wb-prose blockquote:lang(zh),
.wb-prose blockquote:lang(zh-Hans),
.wb-prose blockquote:lang(zh-Hant) {
  font-style: normal;
}

.wb-prose strong {
  font-weight: 700;
}

.wb-prose img {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 1.5em 0;
}

.wb-prose a {
  color: var(--ink);
  text-decoration: underline;
  text-decoration-color: #8f1d14;
}

.mn-marker {
  font-size: 0.78em;
  vertical-align: baseline;
  position: relative;
  cursor: pointer;
  user-select: none;
  color: var(--marker-color);
  text-decoration: none;
  border: none;
}

.mn-note {
  position: relative;
  width: var(--mn-width);
  font-family: var(--font-mn);
  font-size: var(--mn-size);
  line-height: var(--mn-line-height);
  color: var(--muted-ink);
  margin: 0;
  grid-column: 2;
  align-self: start;
}

.mn-note p {
  margin: 0 0 0.6em;
}

.mn-note p:last-child {
  margin-bottom: 0;
}

/* Allow italics in margin notes, but not for Chinese */
.mn-note em:lang(zh),
.mn-note em:lang(zh-Hans),
.mn-note em:lang(zh-Hant),
.mn-note i:lang(zh),
.mn-note i:lang(zh-Hans),
.mn-note i:lang(zh-Hant) {
  font-style: normal;
}


@media (max-width: 950px) {
  .wb-shell {
    padding: 1.5rem 1rem 2rem;
  }

  .wb-frame {
    border-left-width: 2px;
    border-right-width: 2px;
    padding: 1rem;
  }

  .wb-grid {
    display: block;
    position: static;
  }

  .wb-prose {
    max-width: 100%;
  }

  .mn-note {
    position: static;
    width: auto;
    margin: 1em 0;
    padding: 0.75em;
    border-left: 2px solid var(--rule);
    background: rgba(255, 255, 255, 0.5);
    display: none;
    grid-column: auto;
  }

  .mn-note.visible {
    display: block;
  }

  .mn-marker {
    cursor: pointer;
    text-decoration: underline;
    text-decoration-style: dotted;
  }
}
</style>
</head>
<body>
<div class="container">
<div class="controls">
<h1>Design Playground</h1>
<p style="color:#999;margin-bottom:12px;font-size:0.75rem">Full post with aligned margin notes</p>

<h2>Colors</h2>
<div class="control">
  <label>Paper</label>
  <input type="color" id="paper" value="#f6f0e8">
</div>
<div class="control">
  <label>Ink</label>
  <input type="color" id="ink" value="#241425">
</div>
<div class="control">
  <label>Muted</label>
  <input type="color" id="mutedInk" value="#3a223a">
</div>
<div class="control">
  <label>Rule</label>
  <input type="color" id="rule" value="#241425">
</div>
<div class="control">
  <label>Marker (‚Äª)</label>
  <input type="color" id="markerColor" value="#8f1d14">
</div>

<h2>Body Typography</h2>
<div class="control">
  <label>Latin Font</label>
  <select id="bodyLatin">
    <option>Alegreya</option>
    <option selected>Vollkorn</option>
    <option>Georgia</option>
  </select>
</div>
<div class="control">
  <label>CJK Font</label>
  <select id="bodyCJK">
    <option selected>'Noto Serif TC'</option>
  </select>
</div>
<div class="control">
  <label>Size: <span id="bodySizeVal">1.2rem</span></label>
  <input type="range" id="bodySize" min="0.5" max="2" step="0.05" value="1.2">
</div>
<div class="control">
  <label>Leading: <span id="bodyLineHeightVal">1.7</span></label>
  <input type="range" id="bodyLineHeight" min="1.2" max="2.5" step="0.05" value="1.7">
</div>

<h2>Headline Typography</h2>
<div class="control">
  <label>Latin Font</label>
  <select id="displayLatin">
    <option selected>'Noto Sans'</option>
    <option>'Work Sans'</option>
    <option>'Inter'</option>
    <option>'Alegreya Sans'</option>
  </select>
</div>
<div class="control">
  <label>CJK Font</label>
  <select id="displayCJK">
    <option selected>'Noto Sans TC'</option>
    <option>'Source Han Sans TC'</option>
  </select>
</div>
<div class="control">
  <label>H1 Size: <span id="h1SizeVal">2.5em</span></label>
  <input type="range" id="h1Size" min="1.5" max="4" step="0.1" value="2.5">
</div>
<div class="control">
  <label>H1 Leading: <span id="h1LineHeightVal">1.2</span></label>
  <input type="range" id="h1LineHeight" min="1" max="1.8" step="0.05" value="1.2">
</div>
<div class="control">
  <label>H2 Size: <span id="h2SizeVal">1.75em</span></label>
  <input type="range" id="h2Size" min="1" max="3" step="0.05" value="1.75">
</div>
<div class="control">
  <label>H2 Leading: <span id="h2LineHeightVal">1.3</span></label>
  <input type="range" id="h2LineHeight" min="1" max="1.8" step="0.05" value="1.3">
</div>

<h2>Margin Note Typography</h2>
<div class="control">
  <label>Font</label>
  <select id="mnFont">
    <option selected>'Gill Sans'</option>
    <option>'Alegreya Sans'</option>
    <option>'Noto Sans'</option>
    <option>'Inter'</option>
    <option>'Work Sans'</option>
  </select>
</div>
<div class="control">
  <label>Size: <span id="mnSizeVal">0.85rem</span></label>
  <input type="range" id="mnSize" min="0.5" max="1.5" step="0.05" value="0.85">
</div>
<div class="control">
  <label>Leading: <span id="mnLineHeightVal">1.4</span></label>
  <input type="range" id="mnLineHeight" min="1.1" max="2" step="0.05" value="1.4">
</div>

<h2>Layout</h2>
<div class="control">
  <label>Main: <span id="mainWidthVal">64ch</span></label>
  <input type="range" id="mainWidth" min="45" max="90" value="64">
</div>
<div class="control">
  <label>Margin: <span id="mnWidthVal">250px</span></label>
  <input type="range" id="mnWidth" min="150" max="400" step="10" value="250">
</div>
<div class="control">
  <label>Gap: <span id="columnGapVal">3rem</span></label>
  <input type="range" id="columnGap" min="0.5" max="8" step="0.25" value="3">
</div>
<div class="control">
  <label>Frame: <span id="framePadVal">0.75rem</span></label>
  <input type="range" id="framePad" min="0.5" max="4" step="0.25" value="0.75">
</div>
<div class="control">
  <label>Shell: <span id="shellPadVal">8rem</span></label>
  <input type="range" id="shellPad" min="1" max="12" step="0.5" value="8">
</div>
<div class="control">
  <label>Border: <span id="borderWeightVal">12px</span></label>
  <input type="range" id="borderWeight" min="1" max="20" value="12">
</div>

<button onclick="exportJSON()">üìã Copy JSON</button>
</div>

<div class="preview" id="preview">
<div class="wb-shell">
<div class="wb-frame">
<div class="wb-grid">
<article class="wb-prose">
<h1>Tao Yuanming - "Home Again"</h1>

<img src="/tao-yuanming-home-again/assets/431e9e10-c72e-4eb6-843e-9b5197824e7c_6422x2000.jpeg" alt="Calligraphy"></p>

<p><em>Tao Yuanming, "Home Again," in the calligraphy of Zhao Mengfu <span lang="zh-Hant">Ë∂ôÂ≠üÈ†´</span></em></p>

<blockquote lang="zh-Hant">
ÁµêÂª¨Âú®‰∫∫Â¢ÉÔºåËÄåÁÑ°ËªäÈ¶¨Âñß„ÄÇÂïèÂêõ‰ΩïËÉΩÁàæÔºåÂøÉÈÅ†Âú∞Ëá™ÂÅè„ÄÇÊé°ËèäÊù±Á±¨‰∏ãÔºåÊÇ†ÁÑ∂Ë¶ãÂçóÂ±±„ÄÇÂ±±Ê∞£Êó•Â§ï‰Ω≥ÔºåÈ£õÈ≥•Áõ∏ËàáÈÇÑ„ÄÇÊ≠§‰∏≠ÊúâÁúüÊÑèÔºåÊ¨≤Ëæ®Â∑≤ÂøòË®Ä„ÄÇ
</blockquote>

<blockquote>
I built my cottage in the realm of men, and yet there's no clamor of carriages or horses. How, you ask, can it be so? When the mind is detached, one's place becomes remote. I pick chrysanthemums by the eastern hedge, catch sight of the southern mountain in the distance. The mist on the mountain is radiant in twilight; birds on the wing make their way home together. In all this there's some truer meaning ‚Äî I'd tell you, only I've forgot the words.
</blockquote>

<p><em>Tao Yuanming</em> <span lang="zh-Hant">Èô∂Ê∑µÊòé</span>, <em>"Drinking, V"</em> <span lang="zh-Hant">È£≤ÈÖíÔºåÂÖ∂‰∫î</span></p>

Sooner or later, as you scan through Charles O. Hucker's <em>A Dictionary of Official Titles in Imperial China</em>, you'll come across a job title ‚Äî for me it was Dough Pantry Supervisor<sup class="mn-marker" data-target="mn-1">‚Äª</sup> ‚Äî that makes you wonder what Mondays felt like for history dudes. Did the Rectifier of Governance go to work with a spring in his step?</p>

<p>I like to imagine that some nontrivial percentage of officialdom started its week by wistfully muttering Tao Yuanming's poem "Home Again" (<span lang="zh-Hant">Ê≠∏Âéª‰æÜÂÖÆËæ≠</span>) to itself. Tao, the greatest poet of the Northern and Southern Dynasties, was born to a minor southern gentry family under the Eastern Jin and died a few years into the Liu Song.</p>

<h2>The Poem</h2>

<blockquote>
Off home again! My fields and garden will be choked with weeds. What's keeping me? It was me who made my heart my body's thrall ‚Äî why go on being disappointed, lonely, and sad? I realize: the past is beyond repairing, but what's ahead is still worth pursuing.
</blockquote>

<p>I went down the wrong path, yes ‚Äî but not too far. I can tell that this is right and that was wrong. A light breeze rocks my little boat, my robes flutter in the wind.</p>

<p>When people encounter this poem ‚Äî and pretty much everybody literate in Chinese has ‚Äî it's always with the preface, which I left off here for a couple of reasons. The first reason is that I want you to like Tao Yuanming, or at least not be actively irritated by him.<sup class="mn-marker" data-target="mn-2">‚Äª</sup></p>

<p>The other reason is that it's not at all clear how much of the preface is Tao's. Think back to our seventh-century Dough Pantry Supervisor for a minute. If he has a copy of this poem, it's a handwritten one, copied from another handwritten copy of a handwritten copy.</p>

<p>People knew this was a problem. The Song-dynasty poet Su Shi <span lang="zh-Hant">ËòáËªæ</span> deplored the widely circulating version that had <span lang="zh-Hant">Êúõ</span> <em>w√†ng</em>, "to gaze at," instead of <span lang="zh-Hant">Ë¶ã</span> <em>ji√†n</em>, "to catch sight of," in line 6.<sup class="mn-marker" data-target="mn-3">‚Äª</sup></p>

<p>So congratulations and/or condolences to Tao Yuanming, who rejected conventionality so beautifully that he became a new convention, a type-specimen of the literary individualist, authentic to other people's ideas of who he was.</p>

<strong>Happy Monday!</strong></p>
</article>

<aside class="mn-note" id="mn-1">
<span lang="zh-Hant">È∫¥È∫™ÂÄâÁù£</span> q≈´mi√†n cƒÅng d√π</em> ‚Äî SUI-TANG: <strong>Dough Pantry Supervisor</strong><br><br>
2 subordinates in the Office of Grain Supplies of the Court of the Imperial Granaries; responsible for providing the palace with yeast, flour, and dough; discontinued in the period 627-649.
</aside>

<aside class="mn-note" id="mn-2">
You may want to look at James R. Hightower's "The Return: A Rhapsody" for a second opinion ‚Äî the translation starts on page 213. I owe him for a few turns of phrase in my translation of the preface.
</aside>

<aside class="mn-note" id="mn-3">
Modified slightly from Xiaofei Tian's <em>Tao Yuanming and Manuscript Culture</em>, p. 34, which is my source for this and is extremely worth reading for anyone interested.
</aside>

</div>
</div>
</div>
</div>
</div>

<script>
const preview = document.getElementById('preview');

function alignMarginNotes() {
  if (window.innerWidth <= 950) {
    // Mobile: reset positioning
    document.querySelectorAll('.mn-note').forEach(note => {
      note.style.position = 'static';
      note.style.top = '';
    });
    return;
  }

  // Desktop: align note tops with markers
  const grid = document.querySelector('.wb-grid');
  if (!grid) return;
  
  // FIRST: Reset all notes to their natural position
  document.querySelectorAll('.mn-note').forEach(note => {
    note.style.position = 'static';
    note.style.top = '';
  });
  
  // Force a reflow by reading a layout property
  grid.offsetHeight;
  
  // THEN: Calculate offsets based on natural positions
  document.querySelectorAll('.mn-marker').forEach(marker => {
    const targetId = marker.getAttribute('data-target');
    if (!targetId) return;

    const note = document.getElementById(targetId);
    if (!note) return;

    const markerRect = marker.getBoundingClientRect();
    const noteRect = note.getBoundingClientRect();

    // Calculate how much to shift the note vertically
    const verticalOffset = markerRect.top - noteRect.top;
    
    note.style.position = 'relative';
    note.style.top = verticalOffset + 'px';
  });
}
function updatePreview() {
  const values = {
    paper: document.getElementById('paper').value,
    ink: document.getElementById('ink').value,
    mutedInk: document.getElementById('mutedInk').value,
    rule: document.getElementById('rule').value,
    markerColor: document.getElementById('markerColor').value,
    bodyLatin: document.getElementById('bodyLatin').value,
    bodyCJK: document.getElementById('bodyCJK').value,
    displayLatin: document.getElementById('displayLatin').value,
    displayCJK: document.getElementById('displayCJK').value,
    mnFont: document.getElementById('mnFont').value,
    bodySize: document.getElementById('bodySize').value,
    bodyLineHeight: document.getElementById('bodyLineHeight').value,
    h1Size: document.getElementById('h1Size').value,
    h1LineHeight: document.getElementById('h1LineHeight').value,
    h2Size: document.getElementById('h2Size').value,
    h2LineHeight: document.getElementById('h2LineHeight').value,
    mnSize: document.getElementById('mnSize').value,
    mnLineHeight: document.getElementById('mnLineHeight').value,
    mainWidth: document.getElementById('mainWidth').value,
    mnWidth: document.getElementById('mnWidth').value,
    columnGap: document.getElementById('columnGap').value,
    framePad: document.getElementById('framePad').value,
    shellPad: document.getElementById('shellPad').value,
    borderWeight: document.getElementById('borderWeight').value
  };

  // Apply CSS variables
  preview.style.setProperty('--paper', values.paper);
  preview.style.setProperty('--ink', values.ink);
  preview.style.setProperty('--muted-ink', values.mutedInk);
  preview.style.setProperty('--rule', values.rule);
  preview.style.setProperty('--marker-color', values.markerColor);
  preview.style.setProperty('--font-body', values.bodyLatin + ',' + values.bodyCJK + ',serif');
  preview.style.setProperty('--font-display', values.displayLatin + ',' + values.displayCJK + ',sans-serif');
  preview.style.setProperty('--font-mn', values.mnFont + ',' + values.bodyCJK + ',sans-serif');
  preview.style.setProperty('--body-size', values.bodySize + 'rem');
  preview.style.setProperty('--body-line-height', values.bodyLineHeight);
  preview.style.setProperty('--h1-size', values.h1Size + 'em');
  preview.style.setProperty('--h1-line-height', values.h1LineHeight);
  preview.style.setProperty('--h2-size', values.h2Size + 'em');
  preview.style.setProperty('--h2-line-height', values.h2LineHeight);
  preview.style.setProperty('--mn-size', values.mnSize + 'rem');
  preview.style.setProperty('--mn-line-height', values.mnLineHeight);
  preview.style.setProperty('--main-width', values.mainWidth + 'ch');
  preview.style.setProperty('--mn-width', values.mnWidth + 'px');
  preview.style.setProperty('--column-gap', values.columnGap + 'rem');
  preview.style.setProperty('--frame-pad', values.framePad + 'rem');
  preview.style.setProperty('--shell-pad', values.shellPad + 'rem');
  preview.style.setProperty('--border-weight', values.borderWeight + 'px');
  preview.style.backgroundColor = values.paper;

  // Update displayed values
  document.getElementById('bodySizeVal').textContent = values.bodySize + 'rem';
  document.getElementById('bodyLineHeightVal').textContent = values.bodyLineHeight;
  document.getElementById('h1SizeVal').textContent = values.h1Size + 'em';
  document.getElementById('h1LineHeightVal').textContent = values.h1LineHeight;
  document.getElementById('h2SizeVal').textContent = values.h2Size + 'em';
  document.getElementById('h2LineHeightVal').textContent = values.h2LineHeight;
  document.getElementById('mnSizeVal').textContent = values.mnSize + 'rem';
  document.getElementById('mnLineHeightVal').textContent = values.mnLineHeight;
  document.getElementById('mainWidthVal').textContent = values.mainWidth + 'ch';
  document.getElementById('mnWidthVal').textContent = values.mnWidth + 'px';
  document.getElementById('columnGapVal').textContent = values.columnGap + 'rem';
  document.getElementById('framePadVal').textContent = values.framePad + 'rem';
  document.getElementById('shellPadVal').textContent = values.shellPad + 'rem';
  document.getElementById('borderWeightVal').textContent = values.borderWeight + 'px';

  // Realign margin notes after any changes
  setTimeout(alignMarginNotes, 150);
}

// Attach event listeners
document.querySelectorAll('input, select').forEach(element => {
  element.oninput = updatePreview;
});

// Mobile toggle functionality
document.querySelectorAll('.mn-marker').forEach(marker => {
  marker.addEventListener('click', () => {
    if (window.innerWidth > 950) return;

    const targetId = marker.getAttribute('data-target');
    if (!targetId) return;

    const note = document.getElementById(targetId);
    if (!note) return;

    note.classList.toggle('visible');
  });
});

// Realign on window resize
// Debounced resize handler
let resizeTimeout;
window.addEventListener('resize', () => {
  clearTimeout(resizeTimeout);
  resizeTimeout = setTimeout(alignMarginNotes, 100);
});

function exportJSON() {
  const settings = {
    colors: {
      paper: document.getElementById('paper').value,
      ink: document.getElementById('ink').value,
      mutedInk: document.getElementById('mutedInk').value,
      rule: document.getElementById('rule').value,
      markerColor: document.getElementById('markerColor').value
    },
    typography: {
      body: {
        fontLatin: document.getElementById('bodyLatin').value,
        fontCJK: document.getElementById('bodyCJK').value,
        size: parseFloat(document.getElementById('bodySize').value),
        lineHeight: parseFloat(document.getElementById('bodyLineHeight').value)
      },
      headlines: {
        fontLatin: document.getElementById('displayLatin').value,
        fontCJK: document.getElementById('displayCJK').value,
        h1Size: parseFloat(document.getElementById('h1Size').value),
        h1LineHeight: parseFloat(document.getElementById('h1LineHeight').value),
        h2Size: parseFloat(document.getElementById('h2Size').value),
        h2LineHeight: parseFloat(document.getElementById('h2LineHeight').value)
      },
      marginNotes: {
        font: document.getElementById('mnFont').value,
        size: parseFloat(document.getElementById('mnSize').value),
        lineHeight: parseFloat(document.getElementById('mnLineHeight').value)
      }
    },
    layout: {
      mainColumnWidth: parseInt(document.getElementById('mainWidth').value),
      marginNoteWidth: parseInt(document.getElementById('mnWidth').value),
      columnGap: parseFloat(document.getElementById('columnGap').value),
      framePadding: parseFloat(document.getElementById('framePad').value),
      shellPadding: parseFloat(document.getElementById('shellPad').value),
      borderWeight: parseInt(document.getElementById('borderWeight').value)
    }
  };

  navigator.clipboard.writeText(JSON.stringify(settings, null, 2)).then(() => {
    alert('JSON copied to clipboard!');
  });
}

// Initialize on load
updatePreview();
</script>
</body>
</html>
