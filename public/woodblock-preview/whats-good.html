<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>What’s Good — woodblock preview</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vollkorn:ital,wght@0,400;0,600;1,400;1,600&family=Alegreya:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">

    <style>
      :root {
        --paper: #f4f0e6;
        --ink: #231f1a;
        --muted-ink: rgba(35, 31, 26, 0.70);
        --rule: rgba(35, 31, 26, 0.18);

        /* Defaults controlled by the tuner */
        --font-body: "Vollkorn", ui-serif, Georgia, serif;
        --font-mn: "Gill Sans", "Gill Sans Nova", "GillSans", "Calibri", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;

        --body-size: 1.0rem;
        --body-leading: 1.5;

        --main-measure: 72ch;

        --mn-width: 280px;
        --mn-gutter: 2.5rem;

        --frame-pad-x: 2rem;
        --shell-pad-x: 1.5rem;
      }

      * { box-sizing: border-box; }
      html, body { margin: 0; padding: 0; }

      body {
        background: var(--paper);
        color: var(--ink);
        overflow-x: hidden;
      }

      img, svg, video, iframe {
        max-width: 100%;
        height: auto;
      }

      /* Tuner UI */
      .tuner {
        position: sticky;
        top: 0;
        z-index: 50;
        background: rgba(244, 240, 230, 0.92);
        backdrop-filter: blur(6px);
        border-bottom: 1px solid var(--rule);
      }
      .tuner__inner {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0.75rem var(--shell-pad-x);
        display: grid;
        grid-template-columns: 1fr;
        gap: 0.6rem;
        font-family: var(--font-mn);
        font-size: 0.9rem;
        line-height: 1.2;
      }
      .tuner__row {
        display: grid;
        grid-template-columns: 200px 1fr 90px;
        gap: 0.75rem;
        align-items: center;
      }
      .tuner label { color: rgba(35,31,26,0.85); }
      .tuner select,
      .tuner input[type="range"],
      .tuner button {
        font: inherit;
      }
      .tuner select {
        width: 100%;
        padding: 0.25rem 0.35rem;
        border: 1px solid var(--rule);
        background: rgba(255,255,255,0.6);
      }
      .tuner input[type="range"] { width: 100%; }
      .tuner__value {
        text-align: right;
        font-variant-numeric: tabular-nums;
        color: rgba(35,31,26,0.75);
      }
      .tuner__actions {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }
      .tuner button {
        padding: 0.35rem 0.6rem;
        border: 1px solid var(--rule);
        background: rgba(255,255,255,0.65);
        cursor: pointer;
      }

      .wb-shell {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2.5rem var(--shell-pad-x) 4rem;
      }

      .wb-frame {
        border: 1px solid var(--rule);
        padding: 2rem var(--frame-pad-x);
        background: rgba(255,255,255,0.35);
        position: relative;
        overflow-x: clip;
      }

      .wb-grid {
        display: grid;
        grid-template-columns: minmax(0, var(--main-measure)) var(--mn-width);
        gap: var(--mn-gutter);
        align-items: start;
        justify-content: center;
      }

      .wb-prose {
        font-family: var(--font-body);
        font-size: var(--body-size);
        line-height: var(--body-leading);
      }

      .wb-prose p { margin: 0 0 1.1em; }
      .wb-prose h1 { font-size: 1.55em; margin: 0 0 0.6em; letter-spacing: 0.01em; }

      .wb-prose a { color: inherit; text-decoration-thickness: 1px; text-underline-offset: 2px; }

      .wb-prose blockquote {
        margin: 1.2em 0;
        padding-left: 1.1em;
      }

      .wb-prose pre {
        font-family: var(--font-body);
        font-size: 0.92em;
        line-height: 1.35;
        background: transparent;
        padding: 0;
        margin: 1.1em 0;
        white-space: pre;
        overflow-x: auto;
      }

      .mn-marker {
        font-family: var(--font-mn);
        font-size: 0.78em;
        display: inline-block;
        line-height: 1;
        position: relative;
        top: -0.45em;
        margin-left: 0.08em;
        cursor: pointer;
        user-select: none;
        border-bottom: 1px dotted var(--rule);
      }

      .mn-note {
        position: absolute;
        width: var(--mn-width);
        font-family: var(--font-mn);
        font-size: 0.78em;
        line-height: 1.35;
        color: var(--muted-ink);
        margin: 0;
        opacity: 0;
      }
      .mn-note p { margin: 0 0 0.6em; }
      .mn-note p:last-child { margin-bottom: 0; }

      .footnotes { display: none; }

      @media (max-width: 950px) {
        .tuner__row { grid-template-columns: 1fr; }
        .tuner__value { text-align: left; }

        .wb-grid { grid-template-columns: 1fr; justify-content: stretch; }

        .mn-note {
          position: static;
          width: auto;
          opacity: 1;
          margin: 0 0 1.1em;
          padding-left: 1.0em;
          border-left: 1px solid var(--rule);
        }

        .mn-note[hidden] { display: none; }
      }
    </style>
  </head>
  <body>
    <div class="tuner" id="tuner">
      <div class="tuner__inner">
        <div class="tuner__row">
          <label for="fontBody">Body font</label>
          <select id="fontBody">
            <option value="Vollkorn">Vollkorn</option>
            <option value="Alegreya">Alegreya</option>
            <option value="Georgia">Georgia</option>
            <option value="Palatino">Palatino</option>
          </select>
          <div class="tuner__value" id="fontBodyReadout">Vollkorn</div>
        </div>

        <div class="tuner__row">
          <label for="lineHeight">Line height</label>
          <input id="lineHeight" type="range" min="1.2" max="1.9" step="0.01" value="1.50" />
          <div class="tuner__value" id="lineHeightReadout">1.50</div>
        </div>

        <div class="tuner__row">
          <label for="gutter">Gutter width</label>
          <input id="gutter" type="range" min="1" max="6" step="0.05" value="2.50" />
          <div class="tuner__value" id="gutterReadout">2.50rem</div>
        </div>

        <div class="tuner__row">
          <label for="shellPad">Page margin (outer)</label>
          <input id="shellPad" type="range" min="0.5" max="4" step="0.05" value="1.50" />
          <div class="tuner__value" id="shellPadReadout">1.50rem</div>
        </div>

        <div class="tuner__row">
          <label for="framePad">Page margin (inner frame)</label>
          <input id="framePad" type="range" min="0.5" max="4" step="0.05" value="2.00" />
          <div class="tuner__value" id="framePadReadout">2.00rem</div>
        </div>

        <div class="tuner__row">
          <label for="bodyWidth">Body text width</label>
          <input id="bodyWidth" type="range" min="45" max="95" step="1" value="72" />
          <div class="tuner__value" id="bodyWidthReadout">72ch</div>
        </div>

        <div class="tuner__row">
          <label for="mnWidth">Margin note width</label>
          <input id="mnWidth" type="range" min="160" max="520" step="5" value="280" />
          <div class="tuner__value" id="mnWidthReadout">280px</div>
        </div>

        <div class="tuner__actions">
          <button type="button" id="resetTuner">Reset</button>
          <button type="button" id="copySettings">Copy settings</button>
        </div>
      </div>
    </div>

    <div class="wb-shell">
      <div class="wb-frame">
        <div class="wb-grid">
          <article class="wb-prose" id="main">
            <h1>What’s Good?</h1>

            <p>
              <a href="https://substackcdn.com/image/fetch/$s_!VmLi!,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb9cca365-1abb-4ee8-bcde-4447efd0b32f_2620x2048.jpeg">
                <img
                  alt="A scan of the Jinguyuan edition of Jin Shengtan's version of The Romance of the Western Chamber, open to the pages translated here"
                  src="https://substackcdn.com/image/fetch/$s_!VmLi!,w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fb9cca365-1abb-4ee8-bcde-4447efd0b32f_2620x2048.jpeg"
                  loading="lazy"
                  decoding="async"
                />
              </a>
              Jin Shengtan's introduction to "33 Nice Things," 清書坊金谷園刊本
            </p>

            <p>
              So you're reading <em>The Romance of the Western Chamber</em> 西廂記, as one does, and you're reading it in an old woodblock edition, because obviously, and you're hooked. Young Student Zhang has driven away the Flying Tiger and his bandits, and for a moment it looks like there'll be nothing more to stand in the way of his marriage to the well-bred Cui Yingying – but Yingying's mother is having second thoughts about the promise she made. The young lovers have been relying on Yingying's sassy maidservant Hongniang to pass messages, but Yingying's mother is onto them.
            </p>

            <p>
              Is all hope lost? (No.) Will true love prevail? (Yes.) But before you can find out what happens next, you’re confronted with a chatty little digression from the commentator: a list of delightful things, each ending with the words 不亦快哉 <em>bù yì kuài zāi</em> — “Is <em>that</em> not a delight?”
              <sup class="mn-marker" data-mn-id="mn-1" aria-controls="mn-1" aria-expanded="false" title="Toggle note">※</sup>
            </p>
            <aside class="mn-note" id="mn-1" data-mn-id="mn-1" hidden>
              <p>Lin Yutang's translation, the only other one I know of in English, consistently renders <em>bù yì kuài zāi</em> as “Ah, is this not happiness?” while Pierre Ryckmans' French translation goes with “Ah, quel délice!” throughout.</p>
              <p>I vary the translation from item to item, and leave it off entirely after number 26, because I felt like it and because Jin Shengtan is, as of this writing, at least 361 years beyond caring one way or the other.</p>
            </aside>

            <p>
              Stories from a Burning House is a reader-supported publication. To receive new posts and support my work, consider becoming a free or paid subscriber.
            </p>

            <p>
              This is Jin Shengtan's 金聖嘆 "Thirty-three Nice Things" 不亦快哉三十三則, a digression so powerful that it broke free of its original context to become widely known and beloved in its own right, even among the sort of people who do not habitually read pre-20th century editions of 17th-century commentaries on 13th-century updates of 12th-century dramatizations of 9th-century romantic fiction. I thought I might cheer myself up by translating it, and when I was done I thought my friends might enjoy it. I hope you will too.
            </p>

            <hr />

            <p>
              昔與斵山同客共住，霖雨十日，對床無聊，因約賭說快事，以破積悶。至今相距既二十年，亦都不自記憶。偶因讀《西廂》至“拷豔”一篇，見紅娘口中作如許快文，恨當時何不檢取共讀，何積悶之不破。於是反自追索，猶憶得數則，附之左方。但不能辨何句是斵山語，何句是聖嘆語矣。
            </p>

            <p>
              <em>Once, when Zhuoshan</em>
              <sup class="mn-marker" data-mn-id="mn-2" aria-controls="mn-2" aria-expanded="false" title="Toggle note">※</sup>
              <em> and I were lodging together, a ten-day stretch of rain left us stuck indoors with nothing to do but stare at the furniture, and we decided to go back and forth listing happy things to break up the boredom</em>.
              <em> This was twenty years ago, and I’d forgotten all about it until I read this section of</em> <em>The Romance of the Western Chamber</em><em>, “The Questioning,” saw the wonderful lines the author gives Hongniang, and found myself wishing Zhuoshan and I had thought to read the play together. Boredom wouldn’t have stood a chance!</em>
            </p>
            <aside class="mn-note" id="mn-2" data-mn-id="mn-2" hidden>
              <p>‘Zhuoshan’ is probably Wang Han 王瀚. Xu Shuofang 徐朔方 dates Jin’s commentary on <em>The Romance of the Western Chamber</em> to 1657 or slightly later, which would put Jin and Wang’s original list of nice things around 1637; see “<em>Jin Shengtan nianpu</em> 金聖嘆年譜” in Xu, <em>Wan Ming qujia nianpu</em> 晚明曲家年譜, 1.735.</p>
            </aside>

            <p>
              <em>After searching my memory I was able to recover a few of the things we said, which I’ve listed below, but I can’t tell which lines are Zhuoshan’s and which are mine.</em>
            </p>

            <hr />

            <p>
              A friend I haven't seen in ten years shows up one evening. I greet him and immediately dash back inside, even before asking how he got here or inviting him to have a seat, to ask my wife: "I don't suppose you could make like Su Dongpo's old lady
              <sup class="mn-marker" data-mn-id="mn-3" aria-controls="mn-3" aria-expanded="false" title="Toggle note">※</sup>
              and bring us a dipperful of wine?" And she cheerfully pulls the gold pin out of her hair and we figure it'll cover three days' worth of drinking —
            </p>
            <aside class="mn-note" id="mn-3" data-mn-id="mn-3" hidden>
              <p>In the Song-dynasty scholar-official Su Dongpo’s 蘇東坡 ‘Second Rhapsody on the Red Cliff’ (後赤壁賦), Su laments that he has no wine to offer his visitors, but his wife reveals that she’s kept a bit of wine stored away for just such an occasion: (我有鬥酒，藏之久矣，以待子不時之需)</p>
            </aside>

            <p>
              I’m on a little boat when a favorable wind rises, and me without a sail to catch it. A big junk passes, moving quick as the wind, and since I’ve nothing better to do I try throwing my grapnel at it a few times. It catches, to my surprise, and the cable drags me along in the larger boat’s wake, singing Du Fu’s “Unmooring”
              <sup class="mn-marker" data-mn-id="mn-4" aria-controls="mn-4" aria-expanded="false" title="Toggle note">※</sup>
              at the top of my lungs and laughing for joy —
            </p>
            <aside class="mn-note" id="mn-4" data-mn-id="mn-4" hidden>
              <p>Not gonna lie, I really wanted to translate the title as "I'm On A Boat".</p>
            </aside>

            <blockquote>
              <p>Green: too soon the peaks and ridges pass.</p>
              <p>(The orange is the citrus trees ahead.)</p>
            </blockquote>

            <p>
              Reading <em>The Stranger with the Curly Beard</em>
              <sup class="mn-marker" data-mn-id="mn-5" aria-controls="mn-5" aria-expanded="false" title="Toggle note">※</sup>
              —
            </p>
            <aside class="mn-note" id="mn-5" data-mn-id="mn-5" hidden>
              <p>Like Yuan Zhen’s 元稹 <em>The Tale of Yingying</em> 鶯鶯傳, which <em>Western Chamber</em> is based on, <em>The Stranger with the Curly Beard</em> is one of the major works of Tang-dynasty fiction. For the interested, Wang Jing has an exhaustively annotated translation and a very helpful Translator's Note in Bill Nienhauser's <em>Tang Dynasty Tales: A Guided Reader</em>, 189 ff.</p>
            </aside>

            <p>
              We'll leave Jin Shengtan here for now, reading his books and remembering happier times. The next time we check in with him it'll be almost a quarter century after his conversation with Zhuoshan. We'll talk about snappy retorts, vegetarian ham recipes, official corruption, the transfer of New World food crops, and one last ‘ <em>bù yì kuài zāi</em>.’ There'll be some ground to cover between now and then, and probably a lot of tangents, detours, and wild goose chases — but hopefully it'll be worth the going.
            </p>

            <p>Have a nice one. See you next time.</p>
          </article>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const root = document.documentElement;

        const stateDefaults = {
          fontBody: 'Vollkorn',
          lineHeight: 1.5,
          gutterRem: 2.5,
          shellPadRem: 1.5,
          framePadRem: 2.0,
          bodyWidthCh: 72,
          mnWidthPx: 280,
        };

        function fontToCssStack(name) {
          switch (name) {
            case 'Vollkorn':
              return '"Vollkorn", ui-serif, Georgia, serif';
            case 'Alegreya':
              return '"Alegreya", ui-serif, Georgia, serif';
            case 'Georgia':
              return 'Georgia, serif';
            case 'Palatino':
              return '"Palatino Linotype", Palatino, "Book Antiqua", serif';
            default:
              return '"Vollkorn", ui-serif, Georgia, serif';
          }
        }

        function setVar(name, value) {
          root.style.setProperty(name, value);
        }

        function fmt(num, digits = 2) {
          return Number(num).toFixed(digits);
        }

        function applyState(s) {
          setVar('--font-body', fontToCssStack(s.fontBody));
          setVar('--body-leading', String(s.lineHeight));
          setVar('--mn-gutter', `${s.gutterRem}rem`);
          setVar('--shell-pad-x', `${s.shellPadRem}rem`);
          setVar('--frame-pad-x', `${s.framePadRem}rem`);
          setVar('--main-measure', `${s.bodyWidthCh}ch`);
          setVar('--mn-width', `${s.mnWidthPx}px`);

          // Re-run margin note positioning after layout changes
          scheduleAlign();
        }

        function loadState() {
          try {
            const raw = localStorage.getItem('wbTuner');
            if (!raw) return { ...stateDefaults };
            return { ...stateDefaults, ...JSON.parse(raw) };
          } catch {
            return { ...stateDefaults };
          }
        }

        function saveState(s) {
          try {
            localStorage.setItem('wbTuner', JSON.stringify(s));
          } catch {
            // ignore
          }
        }

        const els = {
          fontBody: document.getElementById('fontBody'),
          fontBodyReadout: document.getElementById('fontBodyReadout'),
          lineHeight: document.getElementById('lineHeight'),
          lineHeightReadout: document.getElementById('lineHeightReadout'),
          gutter: document.getElementById('gutter'),
          gutterReadout: document.getElementById('gutterReadout'),
          shellPad: document.getElementById('shellPad'),
          shellPadReadout: document.getElementById('shellPadReadout'),
          framePad: document.getElementById('framePad'),
          framePadReadout: document.getElementById('framePadReadout'),
          bodyWidth: document.getElementById('bodyWidth'),
          bodyWidthReadout: document.getElementById('bodyWidthReadout'),
          mnWidth: document.getElementById('mnWidth'),
          mnWidthReadout: document.getElementById('mnWidthReadout'),
          reset: document.getElementById('resetTuner'),
          copy: document.getElementById('copySettings'),
        };

        let state = loadState();

        function syncUiFromState() {
          els.fontBody.value = state.fontBody;
          els.fontBodyReadout.textContent = state.fontBody;

          els.lineHeight.value = String(state.lineHeight);
          els.lineHeightReadout.textContent = fmt(state.lineHeight, 2);

          els.gutter.value = String(state.gutterRem);
          els.gutterReadout.textContent = `${fmt(state.gutterRem, 2)}rem`;

          els.shellPad.value = String(state.shellPadRem);
          els.shellPadReadout.textContent = `${fmt(state.shellPadRem, 2)}rem`;

          els.framePad.value = String(state.framePadRem);
          els.framePadReadout.textContent = `${fmt(state.framePadRem, 2)}rem`;

          els.bodyWidth.value = String(state.bodyWidthCh);
          els.bodyWidthReadout.textContent = `${state.bodyWidthCh}ch`;

          els.mnWidth.value = String(state.mnWidthPx);
          els.mnWidthReadout.textContent = `${state.mnWidthPx}px`;
        }

        function attachHandlers() {
          els.fontBody.addEventListener('change', () => {
            state.fontBody = els.fontBody.value;
            els.fontBodyReadout.textContent = state.fontBody;
            saveState(state);
            applyState(state);
          });

          els.lineHeight.addEventListener('input', () => {
            state.lineHeight = Number(els.lineHeight.value);
            els.lineHeightReadout.textContent = fmt(state.lineHeight, 2);
            saveState(state);
            applyState(state);
          });

          els.gutter.addEventListener('input', () => {
            state.gutterRem = Number(els.gutter.value);
            els.gutterReadout.textContent = `${fmt(state.gutterRem, 2)}rem`;
            saveState(state);
            applyState(state);
          });

          els.shellPad.addEventListener('input', () => {
            state.shellPadRem = Number(els.shellPad.value);
            els.shellPadReadout.textContent = `${fmt(state.shellPadRem, 2)}rem`;
            saveState(state);
            applyState(state);
          });

          els.framePad.addEventListener('input', () => {
            state.framePadRem = Number(els.framePad.value);
            els.framePadReadout.textContent = `${fmt(state.framePadRem, 2)}rem`;
            saveState(state);
            applyState(state);
          });

          els.bodyWidth.addEventListener('input', () => {
            state.bodyWidthCh = Number(els.bodyWidth.value);
            els.bodyWidthReadout.textContent = `${state.bodyWidthCh}ch`;
            saveState(state);
            applyState(state);
          });

          els.mnWidth.addEventListener('input', () => {
            state.mnWidthPx = Number(els.mnWidth.value);
            els.mnWidthReadout.textContent = `${state.mnWidthPx}px`;
            saveState(state);
            applyState(state);
          });

          els.reset.addEventListener('click', () => {
            state = { ...stateDefaults };
            saveState(state);
            syncUiFromState();
            applyState(state);
          });

          els.copy.addEventListener('click', async () => {
            const payload = {
              fontBody: state.fontBody,
              lineHeight: state.lineHeight,
              gutterRem: state.gutterRem,
              shellPadRem: state.shellPadRem,
              framePadRem: state.framePadRem,
              bodyWidthCh: state.bodyWidthCh,
              mnWidthPx: state.mnWidthPx,
            };
            const text = JSON.stringify(payload, null, 2);
            try {
              await navigator.clipboard.writeText(text);
              els.copy.textContent = 'Copied!';
              setTimeout(() => (els.copy.textContent = 'Copy settings'), 900);
            } catch {
              // Fallback: prompt
              window.prompt('Copy settings JSON:', text);
            }
          });
        }

        // Margin note behavior (same as before, but uses CSS vars for widths)
        function isMobile() {
          return window.matchMedia && window.matchMedia('(max-width: 950px)').matches;
        }

        function setNoteVisibilityForViewport() {
          const mobile = isMobile();
          document.querySelectorAll('.mn-note').forEach((note) => {
            note.hidden = mobile;
            if (!mobile) {
              note.style.opacity = 0;
              note.style.top = '';
              note.style.left = '';
            }
          });

          document.querySelectorAll('.mn-marker').forEach((marker) => {
            marker.setAttribute('aria-expanded', String(!mobile));
          });
        }

        function wireToggles() {
          document.querySelectorAll('.mn-marker').forEach((marker) => {
            marker.addEventListener('click', () => {
              const id = marker.getAttribute('data-mn-id');
              if (!id) return;
              const note = document.getElementById(id);
              if (!note) return;

              if (!isMobile()) return;

              note.hidden = !note.hidden;
              marker.setAttribute('aria-expanded', String(!note.hidden));
            });
          });
        }

        function alignDesktopMarginNotes() {
          if (isMobile()) return;

          const frame = document.querySelector('.wb-frame');
          const grid = document.querySelector('.wb-grid');
          if (!frame || !grid) return;

          const frameRect = frame.getBoundingClientRect();
          const gridRect = grid.getBoundingClientRect();

          const mnWidth = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--mn-width'));
          const marginLeft = (gridRect.left - frameRect.left) + (gridRect.width - mnWidth);

          const entries = [];

          const mnNote = document.querySelector('.mn-note');
          const mnLineHeightPx = mnNote ? parseFloat(getComputedStyle(mnNote).lineHeight) : 16;
          const nudgeUp = mnLineHeightPx;

          document.querySelectorAll('.mn-marker').forEach((marker) => {
            const id = marker.getAttribute('data-mn-id');
            if (!id) return;
            const note = document.getElementById(id);
            if (!note) return;

            note.hidden = false;
            note.style.left = `${Math.round(marginLeft)}px`;

            const markerRect = marker.getBoundingClientRect();
            const desiredTop = (markerRect.bottom - frameRect.top) - nudgeUp;

            entries.push({ note, desiredTop });
          });

          entries.sort((a, b) => a.desiredTop - b.desiredTop);

          const GAP = 12;
          let cursor = 0;

          entries.forEach(({ note, desiredTop }) => {
            const top = Math.max(desiredTop, cursor);
            note.style.top = `${Math.round(top)}px`;
            note.style.opacity = 1;

            const height = note.getBoundingClientRect().height;
            cursor = top + height + GAP;
          });
        }

        function scheduleAlign() {
          window.requestAnimationFrame(alignDesktopMarginNotes);
        }

        function onResize() {
          setNoteVisibilityForViewport();
          scheduleAlign();
        }

        // Init
        syncUiFromState();
        attachHandlers();
        applyState(state);

        setNoteVisibilityForViewport();
        wireToggles();

        window.addEventListener('load', scheduleAlign);
        window.addEventListener('resize', onResize);

        if (document.fonts && document.fonts.ready) {
          document.fonts.ready.then(() => {
            setNoteVisibilityForViewport();
            scheduleAlign();
          });
        }
      })();
    </script>
  </body>
</html>
